var global={timeouts:{tvPictureShake1:null,tvPictureShake2:null},settings:{contactLinkSelectedClass:"contactLinkSelected",loadingClass:"loading",animationSpeed:600,imageDirectory:"http://johncollinson.info/img/"},currentPage:null,pages:{aboutMe:{id:1,name:"aboutme",tvImagePath:"tvfront.png"},myProjects:{id:2,name:"projects",tvImagePath:"tvleft.png"},myCv:{id:3,name:"mycv",tvImagePath:"tvright.png"}},services:{getPage:"php/getpage.php",sendMessage:"php/sendmessage.php"},select:{container:"#container",header:"#header",headerTv:"#headerTv",tvPictureContainer:"#tvPictureContainer",tvBackground:".tvBackground",footer:"#footer",content:"#content",contentMenu:"#contentMenu",contentMenuSelected:".selected",contentMenuLinks:"#contentMenu li a",contentBody:"#contentBody",contactLink:".contactLink a",contactForm:"#contactForm",button:".button",loading:"#loading"},page:{bind:{ui:function(){this.contentMenu_click(),this.contactLink_click(),this.contactForm_submit()},contactForm_submit:function(){$(global.select.contactForm).submit(function(){return global.hlp.sendEmail($(this)),!1})},contactLink_click:function(){$(global.select.contactLink).click(function(){global.hlp.toggleContactFormSlide($(this))})},contentMenu_click:function(){$(global.select.contentMenuLinks).not(global.select.contactLink).click(function(a){a.preventDefault(),$(this).hasClass("selected")||global.hlp.managePageChange($(this))})}},register:{button:function(){$(global.select.button).button()},tvPictureShake:function(){clearTimeout(global.timeouts.tvPictureShake1),clearTimeout(global.timeouts.tvPictureShake2),$tvPicture=$(global.select.tvPictureContainer).find("img");var a=function(a){$tvPicture.effect("shake",{distance:3,times:3},50,a)};$tvPicture.length>0&&$tvPicture.animate({opacity:"0.4"},150,function(){a(null),global.timeouts.tvPictureShake1=setTimeout(function(){var b=function(){$tvPicture.animate({opacity:"1"},250,function(){global.timeouts.tvPictureShake2=setTimeout(function(){global.page.register.tvPictureShake()},5e3)})};a(b)},500)})}}},hlp:{configurePage:function(a){$(global.select.contactForm).hide(),null!=global.currentPage&&(global.hlp.updateMenu(a.id),global.hlp.updateTv(a.tvImagePath)),global.currentPage=a},updateTv:function(a){var b=$(global.select.headerTv),c=b.children(global.select.tvPictureContainer),d=$("<img />").attr("src",global.settings.imageDirectory+a);$currentImage=c.find("img"),d.load(function(){$currentImage.fadeOut(global.settings.animationSpeed,function(){$(this).remove(),d.fadeIn(global.settings.animationSpeed)})}),c.append(d.hide())},updateMenu:function(a){var b=$(global.select.contentMenu);b.find("a").removeClass("selected").removeClass("contactLinkSelected");var c=b.find("#"+global.currentPage.id),d=c.find("h1").html();c.empty().html(d);var e=b.find("#"+a);e.addClass("selected");var f=e.html();e.html("").append($("<h1 />").html(f))},managePageChange:function(a){var b=this.getPageForId(a.attr("id"));global.hlp.configurePage(b),$selectedLink=$(global.select.contentMenu).find("a"+global.select.contentMenuSelected),$selectedLink.addClass(global.settings.loadingClass),$.ajax({type:"POST",url:global.services.getPage,data:{page:b.name},success:function(a){global.hlp.animatePageChange(a),$selectedLink.removeClass(global.settings.loadingClass)},error:function(a){$selectedLink.removeClass(global.settings.loadingClass),alert("Sorry, something's gone wrong contacting the server. Please try again")}})},animatePageChange:function(a){$(global.select.contentBody).animate({left:"550px"},global.settings.animationSpeed,function(){$(this).children().remove(),$(this).css("left","-550px");var b=$("<div />").html(a);$(this).append(b.html()),$(this).animate({left:"0px"},global.settings.animationSpeed)})},getPageForId:function(a){var b={};for(var c in global.pages)if(global.pages[c].id==a){b=global.pages[c];break}return b},getCurrentPageOnLoad:function(){var a=document.URL;for(var b in global.pages)if("-1"!=a.indexOf(global.pages[b].name))return global.pages[b];return global.pages.aboutMe},toggleContactFormSlide:function(a){a.hasClass(global.settings.contactLinkSelectedClass)?(a.removeClass(global.settings.contactLinkSelectedClass),$form=$(global.select.contactForm),$form.slideUp(global.settings.animationSpeed,function(){$form.find("#name,#email,#message").val("").removeClass("ui-state-error"),$(".validateTips").html("All form fields are required.").removeClass("ui-state-highlight")})):($(global.select.contactForm).show("slide",global.settings.animationSpeed),a.addClass(global.settings.contactLinkSelectedClass))},sendEmail:function(a){var b=a.find("#name"),c=a.find("#email"),d=a.find("#message"),e=$([]).add(b).add(c).add(d),f=$(".validateTips"),g=function(a){f.text(a).addClass("ui-state-highlight")},h=function(a,b,c,d){return!(a.val().length>d||a.val().length<c)||(a.addClass("ui-state-error"),g("Length of "+b+" must be "+c+" to "+d+"."),!1)},i=function(a,b,c){return!!b.test(a.val())||(a.addClass("ui-state-error"),g(c),!1)},j=!0;e.removeClass("ui-state-error"),j=j&&h(b,"username",3,50),j=j&&h(c,"email",6,80),j=j&&h(d,"message",10,5e3),j=j&&i(b,/^[a-z]([0-9 a-z])+$/i,"Name may consist of a-z, 0-9"),j=j&&i(c,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"Email address invalid"),j&&(f.removeClass("ui-state-highlight").text(""),$(global.select.loading).show(),$.ajax({type:"POST",url:global.services.sendMessage,data:{name:b.val(),email:c.val(),message:d.val()},success:function(a){$(global.select.loading).hide(),"error"==a?f.text("Sorry, something's gone wrong."):f.text("Thankyou, your message has been sent.")},error:function(a){$(global.select.loading).hide(),f.text("Sorry, something's gone wrong.")}}))}},init:function(){this.hlp.configurePage(this.hlp.getCurrentPageOnLoad()),this.page.register.button(),this.page.register.tvPictureShake(),this.page.bind.ui()}};$(window).ready(function(){global.init()});